app.route("/", methods=["GET", "POST"])
@app.route("/login", methods=["GET", "POST"])
def login():
    erro = None

    if request.method == "POST":
        cpf = request.form.get("usuario")
        senha = request.form.get("senha")

        usuarios = carregar_json(USUARIOS_FILE)
        nomes = carregar_json(NOMES_FILE)

        if cpf in usuarios and usuarios[cpf]["senha"] == senha:
            session["usuario"] = cpf
            session["nome"] = nomes.get(cpf, "Usuário")
            return redirect(url_for("home"))
        else:
            erro = "Usuário ou senha inválidos"

    return render_template("login.html", erro=erro)


@app.route("/home")
def home():
    if "usuario" not in session:
        return redirect(url_for("login"))

    return render_template("home.html", nome=session.get("nome"))


@app.route("/logout")
def logout():
    session.clear()
    return redirect(url_for("login"))


if __name__ == "__main__":
    port = int(os.environ.get("PORT", 10000))
    app.run(host="0.0.0.0", port=port)
